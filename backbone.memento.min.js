/*!
Backbone.Memento v0.4.2

Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
Distributed Under MIT License

Documentation and Full License Available at:
http://github.com/derickbailey/backbone.memento
*/
!function(e,n){"function"==typeof define&&define.amd?define(["underscore","backbone"],n):"object"==typeof module&&module.exports?module.exports=n(require("underscore"),require("backbone")):e.Backbone.Memento=n(e._,e.Backbone)}(this,function(e,n){"use strict";var t=function(n,t){this.version="0.4.2",t=e.extend({ignore:[]},t);var r=new i(n,t),s=new o(n,t),c=function(e,n){e&&r.deserialize(e,n)};this.previousState=function(){return s.previous()},this.store=function(){var e=r.serialize();s.push(e)},this.restore=function(e){var n=s.pop();c(n,e)},this.restart=function(e){var n=s.rewind();c(n,e)},this.changes=function(){var e,n=r.serialize();return s.size()>0?(e=new u(this.previousState(),n),e.diff()):n}},r=function(e){e instanceof n.Model?(this.removeAttr=function(n){e.unset(n)},this.restore=function(n){e.set(n)}):(this.removeAttr=function(n){e.remove(n)},this.restore=function(n){e.reset(n)})},i=function(n,t){function i(n,t){if(n=e.clone(n),e.has(t,"ignore")&&t.ignore.length>0)for(var r in t.ignore){var i=t.ignore[r];delete n[i]}return n}function o(n,t){var r=[];if(!n||!t)return r;for(var i in t)e.has(t,i)&&!e.has(n,i)&&r.push(i);return r}function u(e,n){for(var t in n){var r=n[t];c.removeAttr(r)}}function s(e,t){var r=i(e,t),s=n.toJSON();s=i(s,t);var f=o(r,s);u(n,f),c.restore(r)}var c=new r(n);this.serialize=function(){var e=n.toJSON();return e=i(e,t)},this.deserialize=function(n,r){r=e.extend({},t,r),s(n,r)}},o=function(){function e(){n=[]}var n;this.push=function(e){n.push(e)},this.pop=function(){var e=n.pop();return e},this.rewind=function(){var t=n[0];return e(),t},this.previous=function(){return n[n.length-1]},this.size=function(){return n.length},e()},u=function(n,t){this.previous=n,this.current=t,this.diff=function(){var n=this,t=e.extend({},this.previous,this.current),r={};return e.each(this.current,function(i,o){e.isEqual(n.previous[o],i)||(r[o]=i),delete t[o]}),e.each(t,function(e,n){r[n]=void 0}),r}};return n.Memento=t,t});