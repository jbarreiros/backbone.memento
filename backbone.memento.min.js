/*!
Backbone.Memento v0.4.2

Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
Distributed Under MIT License

Documentation and Full License Available at:
http://github.com/derickbailey/backbone.memento
*/
!function(e,t){"function"==typeof define&&define.amd?define(["underscore","backbone"],t):"object"==typeof module&&module.exports?module.exports=t(require("underscore"),require("backbone")):e.Backbone.Memento=t(e._,e.Backbone)}(this,function(e,t){"use strict";var n=function(t,n){this.version="0.4.2",n=e.extend({ignore:[]},n);var i=new r(t,n),s=new o(t,n),a=function(e,t){e&&i.deserialize(e,t)};this.previousState=function(){return s.previous()},this.store=function(){var e=i.serialize();s.push(e)},this.restore=function(e){var t=s.pop();a(t,e)},this.restart=function(e){var t=s.rewind();a(t,e)},this.changes=function(){var e=i.serialize();console.log("currentState",e);var t;return s.size()>0?(t=this.previousState(),console.log("previousState",t),u.map(e,t)):e}},i=function(e){e instanceof t.Model?(this.removeAttr=function(t){e.unset(t)},this.restore=function(t){e.set(t)}):(this.removeAttr=function(t){e.remove(t)},this.restore=function(t){e.reset(t)})},r=function(t,n){function r(t,n){if(t=e.clone(t),e.has(n,"ignore")&&n.ignore.length>0)for(var i in n.ignore){var r=n.ignore[i];delete t[r]}return t}function o(t,n){var i=[];if(!t||!n)return i;for(var r in n)e.has(n,r)&&!e.has(t,r)&&i.push(r);return i}function u(e,t){for(var n in t){var i=t[n];a.removeAttr(i)}}function s(e,n){var i=r(e,n),s=t.toJSON();s=r(s,n);var c=o(i,s);u(t,c),a.restore(i)}var a=new i(t);this.serialize=function(){var e=t.toJSON();return e=r(e,n)},this.deserialize=function(t,i){i=e.extend({},n,i),s(t,i)}},o=function(){function e(){t=[]}var t;this.push=function(e){t.push(e)},this.pop=function(){var e=t.pop();return e},this.rewind=function(){var n=t[0];return e(),n},this.previous=function(){return t[t.length-1]},this.size=function(){return t.length},e()},u=function(){return{VALUE_CREATED:"created",VALUE_UPDATED:"updated",VALUE_DELETED:"deleted",VALUE_UNCHANGED:"unchanged",map:function(t,n){if(e.isFunction(t)||e.isFunction(n))throw"Invalid argument. Function given, object expected.";if(this.isValue(t)||this.isValue(n)){var i={type:this.compareValues(t,n),data:n||t};return i.type==this.VALUE_CREATED||i.type==this.VALUE_UPDATED?(console.log("return result.data",i.data),i.data):(console.log("return undefined"),void 0)}var r,o,u;for(var s in t)e.isFunction(t[s])||(u=n[s],o=this.map(u,t[s]),void 0!==o&&(r={},r[s]=o));return r},compareValues:function(e,t){return e===t?this.VALUE_UNCHANGED:"undefined"==typeof e?this.VALUE_CREATED:"undefined"==typeof t?this.VALUE_DELETED:this.VALUE_UPDATED},isValue:function(t){return!e.isObject(t)&&!e.isArray(t)}}}();return t.Memento=n,n});