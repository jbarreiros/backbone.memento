/*!
Backbone.Memento v0.4.2

Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
Distributed Under MIT License

Documentation and Full License Available at:
http://github.com/derickbailey/backbone.memento
*/
!function(e,n){"function"==typeof define&&define.amd?define(["underscore","backbone"],n):"object"==typeof module&&module.exports?module.exports=n(require("underscore"),require("backbone")):e.Backbone.Memento=n(e._,e.Backbone)}(this,function(e,n){"use strict";var t=function(n,t){this.version="0.4.2",t=e.extend({ignore:[]},t);var i=new r(n,t),s=new o(n,t),a=function(e,n){e&&i.deserialize(e,n)};this.previousState=function(){return s.previous()},this.store=function(){var e=i.serialize();s.push(e)},this.restore=function(e){var n=s.pop();a(n,e)},this.restart=function(e){var n=s.rewind();a(n,e)},this.changes=function(){var e,n=i.serialize();return s.size()>0?(e=this.previousState(),u.map(n,e)):n}},i=function(e){e instanceof n.Model?(this.removeAttr=function(n){e.unset(n)},this.restore=function(n){e.set(n)}):(this.removeAttr=function(n){e.remove(n)},this.restore=function(n){e.reset(n)})},r=function(n,t){function r(n,t){if(n=e.clone(n),e.has(t,"ignore")&&t.ignore.length>0)for(var i in t.ignore){var r=t.ignore[i];delete n[r]}return n}function o(n,t){var i=[];if(!n||!t)return i;for(var r in t)e.has(t,r)&&!e.has(n,r)&&i.push(r);return i}function u(e,n){for(var t in n){var i=n[t];a.removeAttr(i)}}function s(e,t){var i=r(e,t),s=n.toJSON();s=r(s,t);var c=o(i,s);u(n,c),a.restore(i)}var a=new i(n);this.serialize=function(){var e=n.toJSON();return e=r(e,t)},this.deserialize=function(n,i){i=e.extend({},t,i),s(n,i)}},o=function(){function e(){n=[]}var n;this.push=function(e){n.push(e)},this.pop=function(){var e=n.pop();return e},this.rewind=function(){var t=n[0];return e(),t},this.previous=function(){return n[n.length-1]},this.size=function(){return n.length},e()},u=function(){return{VALUE_CREATED:"created",VALUE_UPDATED:"updated",VALUE_DELETED:"deleted",VALUE_UNCHANGED:"unchanged",map:function(n,t){if(e.isFunction(n)||e.isFunction(t))throw"Invalid argument. Function given, object expected.";if(this.isValue(n)||this.isValue(t)){var i={type:this.compareValues(n,t),data:t||n};return i.type==this.VALUE_CREATED||i.type==this.VALUE_UPDATED?i.data:void 0}var r={};for(var o in n)if(!e.isFunction(n[o])){var u;"undefined"!=typeof t[o]&&(u=t[o]);var s=this.map(u,n[o]);void 0!==s&&(r[o]=s)}return r},compareValues:function(e,n){return e===n?this.VALUE_UNCHANGED:"undefined"==typeof e?this.VALUE_CREATED:"undefined"==typeof n?this.VALUE_DELETED:this.VALUE_UPDATED},isValue:function(n){return!e.isObject(n)&&!e.isArray(n)}}}();return n.Memento=t,t});